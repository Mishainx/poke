<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pepi Poke App</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#ef4444;--muted:#94a3b8;color-scheme:dark}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071128 0%, #071228 60%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .app{width:100%;max-width:820px}
    header{display:flex;flex-direction:column;gap:8px;margin-bottom:18px}
    h1{font-size:20px}
    p.lead{color:var(--muted)}

    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}

    form{display:flex;flex-wrap:wrap;gap:8px}
    input[type="text"]{flex:1 1 200px;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:15px;min-width:0}
    button{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;flex-shrink:0}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:500}

    .result{display:flex;flex-wrap:wrap;gap:16px;align-items:center;margin-top:18px}
    .poke-img{flex-shrink:0;width:120px;height:120px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .poke-img img{max-width:100%;max-height:100%}
    .meta{flex:1;min-width:200px}
    .meta h2{margin-bottom:6px;font-size:18px}
    .meta p{color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);font-size:13px;margin-top:8px}

    footer{margin-top:12px;color:var(--muted);font-size:13px}

    @media (max-width:560px){
      body{padding:8px}
      .poke-img{width:100px;height:100px}
      .meta h2{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="card" style="padding:12px 14px;display:flex;flex-direction:column;gap:4px;">
        <strong style="font-size:16px">Buscador de Pokémon Stadium 2</strong>
        <span style="color:var(--muted);font-size:13px">Ingresa una palabra y te devolveré un Pokémon disponible en Stadium 2 (alea 0.22)</span>
      </div>
    </header>

    <main class="card">
      <form id="searchForm">
        <input id="query" type="text" placeholder="Ej: fuego, dormir, agua, canto..." autocomplete="off"/>
        <button type="submit">Buscar</button>
        <button type="button" id="randomBtn" class="secondary">Sorpresa</button>
      </form>

      <div id="output" style="margin-top:12px"></div>

      <footer>
        <small>Pokémon Stadium 2 incluye Pokémon de la primera y segunda generación. Si la entrada coincide lo suficiente con palabras relacionadas (similitud ≥ 0.22) se elige ese Pokémon; además hay una probabilidad de 0.22 de devolver uno aleatorio.</small>
      </footer>
    </main>
  </div>

  <script>
    const POKEMONS = [
      // Primera generación
      {id:25, name:'Pikachu', keywords:['eléctrico','rayo','ratón','amarillo']},
      {id:4, name:'Charmander', keywords:['fuego','lagarto','cola','llama']},
      {id:1, name:'Bulbasaur', keywords:['planta','semilla','hoja','bulbo']},
      {id:7, name:'Squirtle', keywords:['agua','tortuga','mar','caparazón']},
      {id:39, name:'Jigglypuff', keywords:['canto','dulce','rosa','blando']},
      {id:143, name:'Snorlax', keywords:['dormir','perezoso','comer','gigante']},
      {id:149, name:'Dragonite', keywords:['dragón','vuelo','fuerte','amable']},
      // Segunda generación
      {id:152, name:'Chikorita', keywords:['planta','hoja','cuello','dulce']},
      {id:155, name:'Cyndaquil', keywords:['fuego','ratón','espalda','llama']},
      {id:158, name:'Totodile', keywords:['agua','cocodrilo','mordida','río']},
      {id:172, name:'Pichu', keywords:['eléctrico','rayo','bebé','ratón']},
      {id:196, name:'Espeon', keywords:['psíquico','evolución','sol','gato']},
      {id:197, name:'Umbreon', keywords:['siniestro','evolución','noche','zorro']},
      {id:212, name:'Scizor', keywords:['bicho','acero','pinza','rápido']},
      {id:248, name:'Tyranitar', keywords:['roca','siniestro','dinosaurio','fuerte']},
      {id:249, name:'Lugia', keywords:['psíquico','volador','mar','legendario']},
      {id:250, name:'Ho-oh', keywords:['fuego','volador','legendario','arcoíris']}
    ];

    const ALEA_PROB = 0.22;
    const MATCH_THRESHOLD = 0.22;

    const form = document.getElementById('searchForm');
    const queryInput = document.getElementById('query');
    const output = document.getElementById('output');
    const randomBtn = document.getElementById('randomBtn');

    function normalize(text){
      return text.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '');
    }

    function similarity(input, keywords){
      const inWords = new Set(input.split(/\s+|[,;.]+/).map(w=>normalize(w)).filter(Boolean));
      if(inWords.size===0) return 0;
      const keyWords = new Set(keywords.map(k=>normalize(k)));
      let inter = 0;
      for(const w of inWords) if(keyWords.has(w)) inter++;
      const union = new Set([...inWords, ...keyWords]).size;
      return inter/union;
    }

    function chooseByQuery(text){
      const norm = normalize(text);
      let best = null;
      let bestScore = -1;
      for(const p of POKEMONS){
        const s = similarity(norm, p.keywords);
        if(s>bestScore){ bestScore = s; best = p; }
      }
      const alea = Math.random();
      if(alea < ALEA_PROB) return {pokemon: POKEMONS[Math.floor(Math.random()*POKEMONS.length)], method:'alea', score:bestScore};
      if(bestScore >= MATCH_THRESHOLD){
        return {pokemon: best, method:'match', score:bestScore};
      }
      return {pokemon: POKEMONS[Math.floor(Math.random()*POKEMONS.length)], method:'fallback', score:bestScore};
    }

    function renderResult(res, query){
      const {pokemon, method, score} = res;
      const imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon.id}.png`;
      output.innerHTML = `
        <div class="result">
          <div class="poke-img"><img src="${imgUrl}" alt="${pokemon.name}" onerror="this.style.opacity=0.35"></div>
          <div class="meta">
            <h2>${pokemon.name}</h2>
            <p>Palabra buscada: <strong>${escapeHtml(query || '')}</strong></p>
            <div class="badge">Método: ${method === 'alea' ? 'Aleatorio (probabilidad 0.22)' : method === 'match' ? 'Relacionado (similitud alta)' : 'Aleatorio (sin coincidencias)'} — Score: ${score.toFixed(3)}</div>
            <div style="margin-top:10px;color:var(--muted)">Palabras clave del Pokémon: ${pokemon.keywords.join(', ')}</div>
          </div>
        </div>
      `;
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'})[c]); }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = queryInput.value.trim();
      if(!q){ output.innerHTML = '<div class="badge">Por favor ingresa una palabra o haz click en Sorpresa</div>'; return; }
      const res = chooseByQuery(q);
      renderResult(res, q);
    });

    randomBtn.addEventListener('click', ()=>{
      const res = {pokemon: POKEMONS[Math.floor(Math.random()*POKEMONS.length)], method:'manual-random', score:0};
      renderResult(res, 'Sorpresa');
    });

    queryInput.addEventListener('focus', ()=> queryInput.select());
  </script>
</body>
</html>
