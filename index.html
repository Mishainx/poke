<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pepi Poke App - Stadium 1 y 2</title>
  <style>
    /* Igual que antes, tu CSS */
    :root{--bg:#0f172a;--card:#0b1220;--accent:#ef4444;--muted:#94a3b8;color-scheme:dark}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071128 0%, #071228 60%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .app{width:100%;max-width:820px}
    header{display:flex;flex-direction:column;gap:8px;margin-bottom:18px}
    h1{font-size:20px}
    p.lead{color:var(--muted)}

    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}

    form{display:flex;flex-wrap:wrap;gap:8px}
    input[type="text"]{flex:1 1 200px;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:15px;min-width:0}
    button{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer;flex-shrink:0}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:500}

    .result{display:flex;flex-wrap:wrap;gap:16px;align-items:center;margin-top:18px}
    .poke-img{flex-shrink:0;width:120px;height:120px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .poke-img img{max-width:100%;max-height:100%}
    .meta{flex:1;min-width:200px}
    .meta h2{margin-bottom:6px;font-size:18px}
    .meta p{color:var(--muted)}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);font-size:13px;margin-top:8px}

    footer{margin-top:12px;color:var(--muted);font-size:13px}

    @media (max-width:560px){
      body{padding:8px}
      .poke-img{width:100px;height:100px}
      .meta h2{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="card" style="padding:12px 14px;display:flex;flex-direction:column;gap:4px;">
        <strong style="font-size:16px">Pepi poke app - Pokémon Stadium 1 y 2</strong>
        <span style="color:var(--muted);font-size:13px">Haz click en "Buscar" o "Sorpresa" para un Pokémon aleatorio entre las generaciones 1 y 2.</span>
      </div>
    </header>

    <main class="card">
      <form id="searchForm">
        <input id="query" type="text" placeholder="(Opcional) Ingrese una palabra..." autocomplete="off"/>
        <button type="submit">Buscar</button>
        <button type="button" id="randomBtn" class="secondary">Sorpresa</button>
      </form>

      <div id="output" style="margin-top:12px"></div>

      <footer>
        <small>Pokémon Stadium 1 y 2: Pokémon con ID entre 1 y 251.</small>
      </footer>
    </main>
  </div>

  <script>
    const ALEA_PROB = 0.22; // Factor que podés ajustar si querés

    const form = document.getElementById('searchForm');
    const queryInput = document.getElementById('query');
    const output = document.getElementById('output');
    const randomBtn = document.getElementById('randomBtn');

    // Función para obtener un id aleatorio entre 1 y 251
    function getRandomId() {
      return Math.floor(Math.random() * 251) + 1;
    }

    // Función para obtener datos del Pokémon vía PokeAPI
    async function fetchPokemon(id) {
      try {
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
        if (!res.ok) throw new Error('Pokémon no encontrado');
        const data = await res.json();
        return data;
      } catch (error) {
        console.error(error);
        return null;
      }
    }

    // Renderizar resultado
    function renderPokemon(data, query, method) {
      if (!data) {
        output.innerHTML = '<div class="badge">Error al cargar el Pokémon. Intenta de nuevo.</div>';
        return;
      }
      const imgUrl = data.sprites.front_default || '';
      output.innerHTML = `
        <div class="result">
          <div class="poke-img"><img src="${imgUrl}" alt="${data.name}" /></div>
          <div class="meta">
            <h2>${capitalize(data.name)}</h2>
            <p>Palabra buscada: <strong>${escapeHtml(query || '')}</strong></p>
            <div class="badge">Método: ${method}</div>
            <p><strong>Tipos:</strong> ${data.types.map(t => capitalize(t.type.name)).join(', ')}</p>
            <p><strong>Altura:</strong> ${data.height / 10} m</p>
            <p><strong>Peso:</strong> ${data.weight / 10} kg</p>
          </div>
        </div>
      `;
    }

    // Funciones auxiliares
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' })[c]);
    }

    function capitalize(s) {
      return s.charAt(0).toUpperCase() + s.slice(1);
    }

    // Al hacer submit: ignoramos el texto y elegimos aleatorio con factor
    form.addEventListener('submit', async e => {
      e.preventDefault();
      const alea = Math.random();
      let method;
      let id;
      if (alea < ALEA_PROB) {
        method = 'Aleatorio (factor 0.22)';
        id = getRandomId();
      } else {
        method = 'Aleatorio (resto)';
        id = getRandomId();
      }
      const data = await fetchPokemon(id);
      renderPokemon(data, queryInput.value.trim(), method);
    });

    // Botón sorpresa: simplemente aleatorio
    randomBtn.addEventListener('click', async () => {
      const id = getRandomId();
      const data = await fetchPokemon(id);
      renderPokemon(data, 'Sorpresa', 'Aleatorio');
    });

    queryInput.addEventListener('focus', () => queryInput.select());
  </script>
</body>
</html>
